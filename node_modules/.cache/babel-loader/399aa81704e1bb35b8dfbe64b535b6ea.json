{"ast":null,"code":"import { createSlice, nanoid, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport { sub } from \"date-fns\";\nimport axios from \"axios\";\nconst POSTS_URL = 'https://jsonplaceholder.typicode.com/posts';\nconst initialState = {\n  posts: [],\n  status: 'idle',\n  //'idle' | 'loading' | 'succeeded' | 'failed\n  error: null\n};\nexport const fetchPosts = createAsyncThunk('posts/fetchPosts', async () => {\n  try {\n    const response = await axios.get(POSTS_URL);\n    return [...response.data];\n  } catch (err) {\n    return err.message;\n  }\n});\nexport const addNewPost = createAsyncThunk('posts/addNewPost', async initialPost => {\n  const response = await axios.post(POSTS_URL, initialPost);\n  return response.data;\n});\nconst postsSlice = createSlice({\n  name: 'posts',\n  initialState,\n  reducers: {\n    postAdded: {\n      reducer(state, action) {\n        state.posts.push(action.payload);\n      },\n      prepare(title, content, userId) {\n        return {\n          payload: {\n            id: nanoid(),\n            title,\n            content,\n            date: new Date().toISOString(),\n            userId,\n            reactions: {\n              thumbsUp: 0,\n              wow: 0,\n              heart: 0,\n              rocket: 0,\n              coffee: 0\n            }\n          }\n        };\n      }\n    },\n    reactionAdded(state, action) {\n      const {\n        postId,\n        reaction\n      } = action.payload;\n      const existingPost = state.posts.find(post => post.id === postId);\n      if (existingPost) {\n        existingPost.reactions[reaction]++;\n      }\n    }\n  },\n  extraReducers(builder) {\n    builder.addCase(fetchPosts.pending, (state, action) => {\n      state.status = 'loading';\n    }).addCase(fetchPosts.fulfilled, (state, action) => {\n      state.status = 'succeeded';\n      //добавить дату и реакции\n      let min = 1;\n      const loadedPosts = action.payload.map(post => {\n        post.date = sub(new Date(), {\n          minutes: min++\n        }).toISOString();\n        post.reactions = {\n          thumbsUp: 0,\n          wow: 0,\n          heart: 0,\n          rocket: 0,\n          coffee: 0\n        };\n        return post;\n      });\n      //добавить фетч посты в массив\n      state.posts = state.posts.concat(loadedPosts);\n    }).addCase(fetchPosts.rejected, (state, action) => {\n      state.status = 'failed';\n      state.error = action.error.message;\n    }).addCase(addNewPost.fulfilled, (state, action) => {\n      action.payload.userId = Number(action.payload.userId);\n      action.payload.date = new Date().toISOString();\n      action.payload.reactions = {\n        thumbsUp: 0,\n        wow: 0,\n        heart: 0,\n        rocket: 0,\n        coffee: 0\n      };\n      console.log(action.payload);\n      state.posts.push(action.payload);\n    });\n  }\n});\nexport const selectAllPosts = state => state.posts.posts;\nexport const getPostsStatus = state => state.posts.status;\nexport const getPostsError = state => state.posts.error;\nexport const selectPostById = (state, postId) => {\n  state.posts.posts.find(post => post.id === postId);\n};\nexport const {\n  postAdded,\n  reactionAdded\n} = postsSlice.actions;\nexport default postsSlice.reducer;","map":{"version":3,"names":["createSlice","nanoid","createAsyncThunk","sub","axios","POSTS_URL","initialState","posts","status","error","fetchPosts","response","get","data","err","message","addNewPost","initialPost","post","postsSlice","name","reducers","postAdded","reducer","state","action","push","payload","prepare","title","content","userId","id","date","Date","toISOString","reactions","thumbsUp","wow","heart","rocket","coffee","reactionAdded","postId","reaction","existingPost","find","extraReducers","builder","addCase","pending","fulfilled","min","loadedPosts","map","minutes","concat","rejected","Number","console","log","selectAllPosts","getPostsStatus","getPostsError","selectPostById","actions"],"sources":["/Users/MrsDante/Desktop/React/reactReduxToolkitPosts/src/features/posts/postsSlice.js"],"sourcesContent":["import { createSlice, nanoid, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport { sub } from \"date-fns\";\nimport axios from \"axios\";\n\nconst POSTS_URL = 'https://jsonplaceholder.typicode.com/posts';\n\nconst initialState = {\n    posts: [],\n    status: 'idle', //'idle' | 'loading' | 'succeeded' | 'failed\n    error: null,\n}\n\nexport const fetchPosts = createAsyncThunk('posts/fetchPosts', async () => {\n    try {\n        const response = await axios.get(POSTS_URL);\n        return [...response.data];\n    } catch (err) {\n        return err.message;\n    }\n});\n\nexport const addNewPost = createAsyncThunk('posts/addNewPost', async (initialPost) => {\n    const response = await axios.post(POSTS_URL, initialPost)\n    return response.data\n})\n\nconst postsSlice = createSlice({\n    name: 'posts',\n    initialState,\n    reducers: {\n        postAdded: {\n            reducer (state, action) {\n              state.posts.push(action.payload)\n            },\n            prepare(title, content, userId) {\n                return {\n                        payload: {\n                        id: nanoid(),\n                        title,\n                        content,\n                        date: new Date().toISOString(),\n                        userId,\n                        reactions: {\n                            thumbsUp: 0,\n                            wow: 0,\n                            heart: 0,\n                            rocket: 0,\n                            coffee: 0\n                        }\n                    }\n                }\n            }\n        },\n        reactionAdded(state, action) {\n            const { postId, reaction } = action.payload;\n            const existingPost = state.posts.find(post => post.id === postId);\n\n            if (existingPost) {\n                existingPost.reactions[reaction]++;\n            }\n        }\n    },\n    extraReducers(builder) {\n        builder\n          .addCase(fetchPosts.pending, (state, action) => {\n              state.status = 'loading';\n          })\n          .addCase(fetchPosts.fulfilled, (state, action) => {\n              state.status = 'succeeded';\n              //добавить дату и реакции\n              let min = 1;\n              const loadedPosts = action.payload.map(post => {\n                  post.date = sub(new Date(), { minutes: min++ }).toISOString();\n                  post.reactions = {\n                      thumbsUp: 0,\n                      wow: 0,\n                      heart: 0,\n                      rocket: 0,\n                      coffee: 0,\n                  }\n                  return post;\n              });\n              //добавить фетч посты в массив\n              state.posts = state.posts.concat(loadedPosts);\n          })\n          .addCase(fetchPosts.rejected, (state, action) => {\n              state.status = 'failed';\n              state.error = action.error.message;\n          })\n          .addCase(addNewPost.fulfilled, (state, action) => {\n              action.payload.userId = Number(action.payload.userId);\n              action.payload.date = new Date().toISOString();\n              action.payload.reactions = {\n                  thumbsUp: 0,\n                  wow: 0,\n                  heart: 0,\n                  rocket: 0,\n                  coffee: 0,\n              }\n              console.log(action.payload);\n              state.posts.push(action.payload);\n          })\n    }\n});\n\nexport const selectAllPosts = (state) => state.posts.posts;\nexport const getPostsStatus = (state) => state.posts.status;\nexport const getPostsError = (state) => state.posts.error;\n\nexport const selectPostById = (state, postId) => {\n    state.posts.posts.find(post => post.id === postId);\n}\n\nexport const { postAdded, reactionAdded } = postsSlice.actions;\n\nexport default postsSlice.reducer;"],"mappings":"AAAA,SAASA,WAAW,EAAEC,MAAM,EAAEC,gBAAgB,QAAQ,kBAAkB;AACxE,SAASC,GAAG,QAAQ,UAAU;AAC9B,OAAOC,KAAK,MAAM,OAAO;AAEzB,MAAMC,SAAS,GAAG,4CAA4C;AAE9D,MAAMC,YAAY,GAAG;EACjBC,KAAK,EAAE,EAAE;EACTC,MAAM,EAAE,MAAM;EAAE;EAChBC,KAAK,EAAE;AACX,CAAC;AAED,OAAO,MAAMC,UAAU,GAAGR,gBAAgB,CAAC,kBAAkB,EAAE,YAAY;EACvE,IAAI;IACA,MAAMS,QAAQ,GAAG,MAAMP,KAAK,CAACQ,GAAG,CAACP,SAAS,CAAC;IAC3C,OAAO,CAAC,GAAGM,QAAQ,CAACE,IAAI,CAAC;EAC7B,CAAC,CAAC,OAAOC,GAAG,EAAE;IACV,OAAOA,GAAG,CAACC,OAAO;EACtB;AACJ,CAAC,CAAC;AAEF,OAAO,MAAMC,UAAU,GAAGd,gBAAgB,CAAC,kBAAkB,EAAE,MAAOe,WAAW,IAAK;EAClF,MAAMN,QAAQ,GAAG,MAAMP,KAAK,CAACc,IAAI,CAACb,SAAS,EAAEY,WAAW,CAAC;EACzD,OAAON,QAAQ,CAACE,IAAI;AACxB,CAAC,CAAC;AAEF,MAAMM,UAAU,GAAGnB,WAAW,CAAC;EAC3BoB,IAAI,EAAE,OAAO;EACbd,YAAY;EACZe,QAAQ,EAAE;IACNC,SAAS,EAAE;MACPC,OAAO,CAAEC,KAAK,EAAEC,MAAM,EAAE;QACtBD,KAAK,CAACjB,KAAK,CAACmB,IAAI,CAACD,MAAM,CAACE,OAAO,CAAC;MAClC,CAAC;MACDC,OAAO,CAACC,KAAK,EAAEC,OAAO,EAAEC,MAAM,EAAE;QAC5B,OAAO;UACCJ,OAAO,EAAE;YACTK,EAAE,EAAE/B,MAAM,EAAE;YACZ4B,KAAK;YACLC,OAAO;YACPG,IAAI,EAAE,IAAIC,IAAI,EAAE,CAACC,WAAW,EAAE;YAC9BJ,MAAM;YACNK,SAAS,EAAE;cACPC,QAAQ,EAAE,CAAC;cACXC,GAAG,EAAE,CAAC;cACNC,KAAK,EAAE,CAAC;cACRC,MAAM,EAAE,CAAC;cACTC,MAAM,EAAE;YACZ;UACJ;QACJ,CAAC;MACL;IACJ,CAAC;IACDC,aAAa,CAAClB,KAAK,EAAEC,MAAM,EAAE;MACzB,MAAM;QAAEkB,MAAM;QAAEC;MAAS,CAAC,GAAGnB,MAAM,CAACE,OAAO;MAC3C,MAAMkB,YAAY,GAAGrB,KAAK,CAACjB,KAAK,CAACuC,IAAI,CAAC5B,IAAI,IAAIA,IAAI,CAACc,EAAE,KAAKW,MAAM,CAAC;MAEjE,IAAIE,YAAY,EAAE;QACdA,YAAY,CAACT,SAAS,CAACQ,QAAQ,CAAC,EAAE;MACtC;IACJ;EACJ,CAAC;EACDG,aAAa,CAACC,OAAO,EAAE;IACnBA,OAAO,CACJC,OAAO,CAACvC,UAAU,CAACwC,OAAO,EAAE,CAAC1B,KAAK,EAAEC,MAAM,KAAK;MAC5CD,KAAK,CAAChB,MAAM,GAAG,SAAS;IAC5B,CAAC,CAAC,CACDyC,OAAO,CAACvC,UAAU,CAACyC,SAAS,EAAE,CAAC3B,KAAK,EAAEC,MAAM,KAAK;MAC9CD,KAAK,CAAChB,MAAM,GAAG,WAAW;MAC1B;MACA,IAAI4C,GAAG,GAAG,CAAC;MACX,MAAMC,WAAW,GAAG5B,MAAM,CAACE,OAAO,CAAC2B,GAAG,CAACpC,IAAI,IAAI;QAC3CA,IAAI,CAACe,IAAI,GAAG9B,GAAG,CAAC,IAAI+B,IAAI,EAAE,EAAE;UAAEqB,OAAO,EAAEH,GAAG;QAAG,CAAC,CAAC,CAACjB,WAAW,EAAE;QAC7DjB,IAAI,CAACkB,SAAS,GAAG;UACbC,QAAQ,EAAE,CAAC;UACXC,GAAG,EAAE,CAAC;UACNC,KAAK,EAAE,CAAC;UACRC,MAAM,EAAE,CAAC;UACTC,MAAM,EAAE;QACZ,CAAC;QACD,OAAOvB,IAAI;MACf,CAAC,CAAC;MACF;MACAM,KAAK,CAACjB,KAAK,GAAGiB,KAAK,CAACjB,KAAK,CAACiD,MAAM,CAACH,WAAW,CAAC;IACjD,CAAC,CAAC,CACDJ,OAAO,CAACvC,UAAU,CAAC+C,QAAQ,EAAE,CAACjC,KAAK,EAAEC,MAAM,KAAK;MAC7CD,KAAK,CAAChB,MAAM,GAAG,QAAQ;MACvBgB,KAAK,CAACf,KAAK,GAAGgB,MAAM,CAAChB,KAAK,CAACM,OAAO;IACtC,CAAC,CAAC,CACDkC,OAAO,CAACjC,UAAU,CAACmC,SAAS,EAAE,CAAC3B,KAAK,EAAEC,MAAM,KAAK;MAC9CA,MAAM,CAACE,OAAO,CAACI,MAAM,GAAG2B,MAAM,CAACjC,MAAM,CAACE,OAAO,CAACI,MAAM,CAAC;MACrDN,MAAM,CAACE,OAAO,CAACM,IAAI,GAAG,IAAIC,IAAI,EAAE,CAACC,WAAW,EAAE;MAC9CV,MAAM,CAACE,OAAO,CAACS,SAAS,GAAG;QACvBC,QAAQ,EAAE,CAAC;QACXC,GAAG,EAAE,CAAC;QACNC,KAAK,EAAE,CAAC;QACRC,MAAM,EAAE,CAAC;QACTC,MAAM,EAAE;MACZ,CAAC;MACDkB,OAAO,CAACC,GAAG,CAACnC,MAAM,CAACE,OAAO,CAAC;MAC3BH,KAAK,CAACjB,KAAK,CAACmB,IAAI,CAACD,MAAM,CAACE,OAAO,CAAC;IACpC,CAAC,CAAC;EACR;AACJ,CAAC,CAAC;AAEF,OAAO,MAAMkC,cAAc,GAAIrC,KAAK,IAAKA,KAAK,CAACjB,KAAK,CAACA,KAAK;AAC1D,OAAO,MAAMuD,cAAc,GAAItC,KAAK,IAAKA,KAAK,CAACjB,KAAK,CAACC,MAAM;AAC3D,OAAO,MAAMuD,aAAa,GAAIvC,KAAK,IAAKA,KAAK,CAACjB,KAAK,CAACE,KAAK;AAEzD,OAAO,MAAMuD,cAAc,GAAG,CAACxC,KAAK,EAAEmB,MAAM,KAAK;EAC7CnB,KAAK,CAACjB,KAAK,CAACA,KAAK,CAACuC,IAAI,CAAC5B,IAAI,IAAIA,IAAI,CAACc,EAAE,KAAKW,MAAM,CAAC;AACtD,CAAC;AAED,OAAO,MAAM;EAAErB,SAAS;EAAEoB;AAAc,CAAC,GAAGvB,UAAU,CAAC8C,OAAO;AAE9D,eAAe9C,UAAU,CAACI,OAAO"},"metadata":{},"sourceType":"module"}